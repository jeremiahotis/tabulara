{
  "success": true,
  "subprocess": "atdd-e2e-tests",
  "tests": [
    {
      "file": "tests/e2e/story-1-3-import-documents-with-duplicate-handling.spec.ts",
      "content": "import { test, expect } from '@playwright/test';\n\ntest.describe('Story 1.3 document import + duplicate handling workflow (ATDD RED)', () => {\n  test.skip(\n    '[P0][AC1] should import document command payload and surface DocumentImported traceability',\n    async ({ page }) => {\n      const importResponse = page.waitForResponse(\n        (response) =>\n          response.url().includes('/api/v1/commands/dispatch') &&\n          response.request().method() === 'POST' &&\n          response.status() === 202,\n      );\n\n      await page.goto('/');\n      await page.getByTestId('command-type-input').fill('ImportDocument');\n      await page.getByTestId('import-session-id-input').fill('session-import-001');\n      await page.getByTestId('import-blob-ids-input').fill('blob-import-001,blob-import-002');\n      await page.getByTestId('import-metadata-source-input').fill('import');\n      await page.getByTestId('import-file-name-input').fill('invoice-001.pdf');\n      await page.getByTestId('command-submit-button').click();\n\n      await importResponse;\n\n      await expect(page.getByTestId('mutation-state')).toHaveText('applied');\n      await expect(page.getByTestId('event-append-state')).toHaveText('appended');\n      await expect(page.getByTestId('document-last-imported-blob-id')).toHaveText(/blob-import-001/);\n      await expect(page.getByTestId('audit-event-type-latest')).toHaveText('DocumentImported');\n      await expect(page.getByTestId('audit-event-caused-by-latest')).toHaveText(/.+/);\n    },\n  );\n\n  test.skip(\n    '[P0][AC2] should confirm duplicate candidate and persist duplicate linkage state',\n    async ({ page }) => {\n      const importResponse = page.waitForResponse(\n        (response) =>\n          response.url().includes('/api/v1/commands/dispatch') &&\n          response.request().method() === 'POST' &&\n          response.status() === 202,\n      );\n\n      await page.goto('/');\n      await page.getByTestId('command-type-input').fill('ImportDocument');\n      await page.getByTestId('import-session-id-input').fill('session-import-002');\n      await page.getByTestId('import-blob-ids-input').fill('blob-dup-source');\n      await page.getByTestId('import-metadata-source-input').fill('import');\n      await page.getByTestId('import-file-name-input').fill('invoice-dup-source.pdf');\n      await page.getByTestId('command-submit-button').click();\n      await importResponse;\n\n      const duplicateResponse = page.waitForResponse(\n        (response) =>\n          response.url().includes('/api/v1/commands/dispatch') &&\n          response.request().method() === 'POST' &&\n          response.status() === 202,\n      );\n\n      await page.getByTestId('command-type-input').fill('ConfirmDuplicate');\n      await page.getByTestId('duplicate-session-id-input').fill('session-import-002');\n      await page.getByTestId('duplicate-document-id-input').fill('doc-duplicate-001');\n      await page.getByTestId('duplicate-of-document-id-input').fill('doc-original-001');\n      await page.getByTestId('duplicate-source-command-id-input').fill('cmd-import-001');\n      await page.getByTestId('command-submit-button').click();\n\n      await duplicateResponse;\n\n      await expect(page.getByTestId('duplicate-state-latest')).toHaveText('duplicate');\n      await expect(page.getByTestId('duplicate-of-document-id-latest')).toHaveText('doc-original-001');\n      await expect(page.getByTestId('audit-event-type-latest')).toHaveText('DuplicateMarked');\n    },\n  );\n\n  test.skip(\n    '[P1][AC2] should surface deterministic duplicate correlation evidence for operators',\n    async ({ page }) => {\n      const duplicateResponse = page.waitForResponse(\n        (response) =>\n          response.url().includes('/api/v1/commands/dispatch') &&\n          response.request().method() === 'POST' &&\n          response.status() === 202,\n      );\n\n      await page.goto('/');\n      await page.getByTestId('command-type-input').fill('ConfirmDuplicate');\n      await page.getByTestId('duplicate-session-id-input').fill('session-import-003');\n      await page.getByTestId('duplicate-document-id-input').fill('doc-duplicate-003');\n      await page.getByTestId('duplicate-of-document-id-input').fill('doc-original-003');\n      await page.getByTestId('duplicate-source-command-id-input').fill('cmd-import-003');\n      await page.getByTestId('command-submit-button').click();\n\n      await duplicateResponse;\n\n      await expect(page.getByTestId('duplicate-correlation-key-latest')).toHaveText(\n        /session-import-003:doc-duplicate-003:doc-original-003/,\n      );\n      await expect(page.getByTestId('duplicate-linked-import-command-latest')).toHaveText('cmd-import-003');\n      await expect(page.getByTestId('audit-event-caused-by-latest')).toHaveText(/.+/);\n    },\n  );\n});\n",
      "description": "ATDD E2E tests for Story 1.3 import + duplicate user journey (RED PHASE)",
      "expected_to_fail": true,
      "acceptance_criteria_covered": [
        "Operator can import one or more source documents with persisted metadata/blob references",
        "Operator can confirm duplicate handling linked to original import context",
        "Duplicate correlation evidence is visible in UI traceability surfaces"
      ],
      "priority_coverage": {
        "P0": 2,
        "P1": 1,
        "P2": 0,
        "P3": 0
      }
    }
  ],
  "fixture_needs": [
    "documentImportCommandData",
    "duplicateCorrelationViewData"
  ],
  "knowledge_fragments_used": [
    "selector-resilience",
    "timing-debugging",
    "test-quality"
  ],
  "test_count": 3,
  "tdd_phase": "RED",
  "summary": "Generated 3 FAILING E2E tests for Story 1.3 import and duplicate confirmation workflow"
}
