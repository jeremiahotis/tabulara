{
  "success": true,
  "subprocess": "api-tests",
  "tests": [
    {
      "file": "tests/api/story-1-2-create-and-pin-sessions-through-command-handlers.automation.spec.ts",
      "content": "import { test, expect } from '../support/fixtures';\nimport {\n  createCreateSessionCommandEnvelope,\n  createPinSessionCommandEnvelope,\n} from '../support/fixtures/factories/session-command-factory';\n\ntest.describe('Story 1.2 API automation coverage', () => {\n  test('[P0][AC1] should accept CreateSession envelopes through the dispatcher contract', async ({\n    apiRequest,\n  }) => {\n    const command = createCreateSessionCommandEnvelope({\n      payload: {\n        project_id: 'project-123',\n        schema_id: 'schema-123',\n      },\n    });\n\n    const { status, body } = await apiRequest<{\n      accepted: boolean;\n      command_id: string;\n      mutation_applied: boolean;\n      event_appended: boolean;\n    }>({\n      method: 'POST',\n      path: '/api/v1/commands/dispatch',\n      body: command,\n    });\n\n    expect(status).toBe(202);\n    expect(body).toMatchObject({\n      accepted: true,\n      command_id: command.command_id,\n      mutation_applied: true,\n      event_appended: true,\n    });\n  });\n\n  test('[P0][AC2] should accept PinSession pin envelopes and mark mutation/event append as applied', async ({\n    apiRequest,\n  }) => {\n    const command = createPinSessionCommandEnvelope({\n      payload: { pinned: true },\n    });\n\n    const { status, body } = await apiRequest<{\n      accepted: boolean;\n      command_id: string;\n      mutation_applied: boolean;\n      event_appended: boolean;\n    }>({\n      method: 'POST',\n      path: '/api/v1/commands/dispatch',\n      body: command,\n    });\n\n    expect(status).toBe(202);\n    expect(body).toMatchObject({\n      accepted: true,\n      command_id: command.command_id,\n      mutation_applied: true,\n      event_appended: true,\n    });\n  });\n\n  test('[P1][AC2] should accept PinSession unpin envelopes and preserve dispatcher success contract', async ({\n    apiRequest,\n  }) => {\n    const command = createPinSessionCommandEnvelope({\n      payload: { pinned: false },\n    });\n\n    const { status, body } = await apiRequest<{\n      accepted: boolean;\n      command_id: string;\n      mutation_applied: boolean;\n      event_appended: boolean;\n    }>({\n      method: 'POST',\n      path: '/api/v1/commands/dispatch',\n      body: command,\n    });\n\n    expect(status).toBe(202);\n    expect(body).toMatchObject({\n      accepted: true,\n      command_id: command.command_id,\n      mutation_applied: true,\n      event_appended: true,\n    });\n  });\n\n  test('[P1][AC1] should reject malformed JSON with deterministic validation metadata', async ({\n    request,\n  }) => {\n    const response = await request.post('/api/v1/commands/dispatch', {\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      data: '{',\n    });\n\n    expect(response.status()).toBe(400);\n    const body = (await response.json()) as {\n      error: {\n        code: string;\n        category: string;\n      };\n      mutation_applied: boolean;\n      event_appended: boolean;\n    };\n\n    expect(body).toMatchObject({\n      error: {\n        code: 'CMD_INVALID_JSON',\n        category: 'validation',\n      },\n      mutation_applied: false,\n      event_appended: false,\n    });\n  });\n});\n",
      "description": "API automation coverage for Story 1.2 command dispatch flows",
      "priority_coverage": {
        "P0": 2,
        "P1": 2,
        "P2": 0,
        "P3": 0
      }
    }
  ],
  "fixture_needs": [
    "sessionCommandFactory",
    "apiRequestFixture"
  ],
  "knowledge_fragments_used": [
    "api-request",
    "data-factories",
    "test-levels-framework",
    "test-priorities-matrix"
  ],
  "test_count": 4,
  "summary": "Generated 4 API automation tests for Story 1.2 dispatcher contracts"
}